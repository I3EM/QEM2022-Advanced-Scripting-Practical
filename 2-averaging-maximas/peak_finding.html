<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Suggested Approach - QEM Practical: Advanced Script Programming for Image Processing in Digital Micrograph</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../mdbook-admonish.css">
        <link rel="stylesheet" href="../mermaid.css">

        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../0-introduction/introduction.html">Introduction</a></li><li class="chapter-item expanded affix "><a href="../0-introduction/using-this-document.html">How to Use this Document</a></li><li class="chapter-item expanded affix "><a href="../0-introduction/pick_image.html">Pick an Image</a></li><li class="chapter-item expanded affix "><a href="../0-introduction/mystery_processing.html">Overview of the Mystery Processing</a></li><li class="chapter-item expanded "><a href="../1-extracting-pseudospectrum/recap.html"><strong aria-hidden="true">1.</strong> Reverting the Transfer Function</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../1-extracting-pseudospectrum/pseudospectrum.html"><strong aria-hidden="true">1.1.</strong> Extracting the Pseudospectrum</a></li><li class="chapter-item expanded "><a href="../2-averaging-maximas/maxima.html"><strong aria-hidden="true">1.2.</strong> Averaging Maxima Positions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../2-averaging-maximas/peak_finding.html" class="active"><strong aria-hidden="true">1.2.1.</strong> Suggested Approach</a></li><li class="chapter-item expanded "><a href="../2-averaging-maximas/solution_part1b.html"><strong aria-hidden="true">1.2.2.</strong> Proposed Implementation</a></li></ol></li><li class="chapter-item expanded "><a href="../3-reverting-transfer-function/mtf.html"><strong aria-hidden="true">1.3.</strong> Performing the Inversion</a></li></ol></li><li class="chapter-item expanded "><a href="../4-removing-polynomials/part_2.html"><strong aria-hidden="true">2.</strong> Removing the Distortion</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../4-removing-polynomials/lls.html"><strong aria-hidden="true">2.1.</strong> Suggested Approach</a></li><li class="chapter-item expanded "><a href="../4-removing-polynomials/solution_part2.html"><strong aria-hidden="true">2.2.</strong> Proposed Implementation</a></li></ol></li><li class="chapter-item expanded "><a href="../5-installing-scripts/part_3.html"><strong aria-hidden="true">3.</strong> Reconstructing the Image</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><a href="../6-appendices/references.html">To Go Further</a></li><li class="chapter-item expanded affix "><a href="../6-appendices/mystery_processing_complete.html">Mystery Processing: Complete Script</a></li><li class="chapter-item expanded affix "><a href="../6-appendices/proposed_solution_complete.html">Proposed Solution: Complete Script</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">QEM Practical: Advanced Script Programming for Image Processing in Digital Micrograph</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="suggested-approach-averaging-maxima-positions"><a class="header" href="#suggested-approach-averaging-maxima-positions">Suggested Approach: Averaging Maxima Positions</a></h1>
<h2 id="peak-finding"><a class="header" href="#peak-finding">Peak Finding</a></h2>
<p>Out of the many possibilities for retrieving the local maximums of a 1D image,
the simplest is probably to rely on the fact that, for a discrete function
\(u_n\) where \(n\) is an integer, the list of local maximums is defined by:
\[\{ n \in \mathbb{N} | u_{n - 1} \le u_n \text{ and } u_{n - 1} \le u_n \}\]</p>
<div id="admonition-warning" class="admonition warning">
<div class="admonition-title">
<p>Warning</p>
</div>
<div>
<p>This method may not work well in the presence of noise. In that case, you
can try to filter your input to get cleaner result. In our case, this is not 
necessary.</p>
</div>
</div>
<div id="admonition-the-sum-pattern" class="admonition info">
<div class="admonition-title">
<p>The <code>sum</code>-pattern</p>
</div>
<div>
<p>Due to the way the <code>=</code> operator work on images, the result of using the
<code>[]</code> operator on an image (like in <code>img[1, 6]</code>) is a 0D point image.
However, we often need a <code>Number</code> instead of an <code>Image</code>. The most
reliable way to do that is to use the <code>sum</code> function, which gives
us a <code>Number</code>. Since a 0D image has only 1 value, the sum returns this
value.
Therefore, if you need to extract the value of say, the pixel <code>(1, 2)</code>
of the image <code>img</code>, you would do:</p>
<pre><code class="language-java">sum(img[1, 2])
</code></pre>
</div>
</div>
<h2 id="averaging"><a class="header" href="#averaging">Averaging</a></h2>
<p>Let \(u_i\) be a finite sequence of \(n\) values to be averaged, with
\(n, i \in \mathbb{N}, i &lt; n\).</p>
<p>The mean \(\overline{u}\) is defined as:
\[\overline{u} = \frac{1}{n} \sum_{i=0}^{n-1} u_i\]</p>
<details id="admonition-optional-cumulative-averaging" class="admonition info">
<summary class="admonition-title">
<p>Optional: cumulative averaging</p>
</summary>
<div>
<p>Sometimes, you need to maintain an average of the values you already got.
In this cases, it is more convenient to use the cumulative mean \(\overline{u}_i\):
\[
\begin{aligned}
\overline{u}_0       &amp; = u_0 \\
\overline{u}_{i+1}   &amp; = \overline{u}_i + \frac{u_{i+1} - \overline{u}_i}{i+1}\\
\overline{u}          &amp; = \overline{u}_{n}
\end{aligned}
\]</p>
</div>
</details>
<h2 id="recap-how-do-i"><a class="header" href="#recap-how-do-i">Recap: How do I...</a></h2>
<details id="admonition--print-a-number-or-a-string" class="admonition info">
<summary class="admonition-title">
<p>... print a number or a string?</p>
</summary>
<div>
<p>To print something in Digital Micrograph in the <code>Output</code> window, you use
the <code>result</code> function:</p>
<pre><code class="language-java">result(&quot;Here I print a string\n&quot;)
result(&quot;And now, here's a number:&quot; + 42 + &quot;\n&quot;)
result(&quot;I can also print the number alone :&quot;)
result(42 + &quot;\n&quot;)
</code></pre>
<p>The <code>\n</code> character sequence is used to print a new line. You will want to
append it at the end of your strings for readability.</p>
</div>
</details>
<details id="admonition--get-the-size-of-an-image" class="admonition info">
<summary class="admonition-title">
<p>... get the size of an image?</p>
</summary>
<div>
<p><code>imageGetDimensionSize</code> allows one to get the size of one dimension of an
image.</p>
<p>It is used like this:</p>
<pre><code class="language-java">Number size = imageGetDimensionSize(my_image_variable, the_dimension_i_want)
</code></pre>
<p>For example, if you want the first dimension (which is the \(x\) dimension)
of an image, you will do:</p>
<pre><code class="language-java">imageGetDimensionSize(my_image_variable, 0)
</code></pre>
<p>For 2D, 3D and 4D images, the \(y\) dimension (second dimension) is <code>1</code>, for
\(z\) it is 2, and so on.</p>
</div>
</details>
<details id="admonition--write-a-for-loop" class="admonition info">
<summary class="admonition-title">
<p>... write a <code>for</code>-loop?</p>
</summary>
<div>
<p><code>for</code>-loops in Digital Micrograph use a <code>C</code>-like syntax:</p>
<pre><code class="language-java">// ++i is a shorthand for i = i + 1
for (Number i = 0 ; i &lt; 10 ; ++i) {
    result(i + &quot;\n&quot;)
}
</code></pre>
<p>This one means:</p>
<ul>
<li>Start with a number <code>i</code> equals to zero</li>
<li>While <code>i</code> is lesser than 10, do:
<ul>
<li>Print <code>i</code></li>
<li>Increase <code>i</code> by 1</li>
</ul>
</li>
</ul>
<p>The syntax can be broken down like this:</p>
<pre><code class="language-java">for (Initialisation ; Loop condition ; What to do after each iteration) {
    What to do for each iteration
}
</code></pre>
</div>
</details>
<details id="admonition--write-an-if-statement" class="admonition info">
<summary class="admonition-title">
<p>... write an <code>if</code> statement?</p>
</summary>
<div>
<p><code>if</code> statements in Digital Micrograph use a <code>C</code>-like syntax:</p>
<pre><code class="language-java">Number n = random()
if (n &lt; 0.5) {
    result(&quot;Less than 0.5!\n&quot;)
} else {
    result(&quot;More than 0.5!\n&quot;)
}
</code></pre>
<p>If you want to test different cases separately, one after the other, you can use <code>else if</code>:</p>
<pre><code class="language-java">Number n = random()
if (n &lt; 0.3) {
    result(&quot;Less than 0.3!\n&quot;)
} else if (n &lt; 0.5) {
    result(&quot;Between 0.3 and 0.5!\n&quot;)
} else {
    result(&quot;More than 0.5!\n&quot;)
}
</code></pre>
<p>To combine different conditions into one, you can use <code>&amp;&amp;</code> (<em>and</em>) and <code>||</code> (<em>or</em>):</p>
<pre><code>Number n = random()
if (0.3 &lt; n &amp;&amp; n &lt; 0.5) {
    result(&quot;Between 0.3 AND 0.5!\n&quot;)
}

n = random()
if (n &lt; 0.3 || 0.5 &lt; n) {
    result(&quot;Either below 0.3 OR above 0.5!\n&quot;)
}
</code></pre>
</div>
</details>
<details id="admonition--access-a-pixel-value" class="admonition info">
<summary class="admonition-title">
<p>... access a pixel value?</p>
</summary>
<div>
<p>The syntax for accessing a given pixel (let's say x = 1 and y = 43) of the image
<code>img</code> is:</p>
<pre><code class="language-java">img[1, 43]
</code></pre>
<p>Tu use this access, you must do like this:</p>
<pre><code class="language-java">// Here we change the value of the pixel.
img[1, 43] = 42
// Here we read the value of the pixel.
// We have to wrap it inside sum( ) to get a Number,
// as explained in &quot;The sum-pattern&quot; info box above.
Number pixel_value = sum(img[1, 43])
</code></pre>
<p>For 1D images, the syntax is the same, except \(y\) is always
equal to <code>0</code>, since whe only have a line image:</p>
<pre><code class="language-java">// For pixel at x = 42
img[42, 0]
</code></pre>
</div>
</details>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../2-averaging-maximas/maxima.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../2-averaging-maximas/solution_part1b.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../2-averaging-maximas/maxima.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../2-averaging-maximas/solution_part1b.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script type="text/javascript">
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script type="text/javascript">
            window.playground_copyable = true;
        </script>

        <script src="../ace.js" type="text/javascript" charset="utf-8"></script>
        <script src="../editor.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mode-rust.js" type="text/javascript" charset="utf-8"></script>
        <script src="../theme-dawn.js" type="text/javascript" charset="utf-8"></script>
        <script src="../theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>

        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="../mermaid.min.js"></script>
        <script type="text/javascript" src="../mermaid-init.js"></script>


    </body>
</html>
